{if(!Array.prototype.indexOf){Array.prototype.indexOf=function(item,from){var len=this.length;var i=from||0;if(i<0){i+=len;}for(;i<len;i++){if(i in this&&this[i]===item){return i;}}return -1;};}(function(){if(typeof window.CustomEvent==="function")return false;function CustomEvent(event,params){params=params||{"bubbles":false,"cancelable":false,"detail":null};var evt=document.createEvent("CustomEvent");evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt;}CustomEvent.prototype=window.Event.prototype;window.CustomEvent=CustomEvent;})();if(!window.DOT){(function(){var AFTER_CFG_EVENT="dot-cfg";var LAZY_LOADING_ENABLED=1;var LAZY_LOADING_DISABLED=2;var scripts=document.querySelectorAll("script");var scriptSrc="";for(var s=0;s<scripts.length;s++){var src=scripts[s].src;if(src.indexOf("/dot-small.js?")!=-1){scriptSrc=src.substr(src.indexOf("?"));break;}}if(scriptSrc!=""){var hostFromQueryString=scriptSrc.substr(1).split("=")[1];}var protocol="http:";if(location.protocol==="https:"){protocol=location.protocol;}var DOT=function(){this._plugins=[];this._ts=0;this._dataElms=[];this._delayed={"action":"","timeout":null,"count":0};this._configured=0;this._SPAReferrer="";this._hitQueue=[];this._lazyLoadingStatus=LAZY_LOADING_DISABLED;this._cfg={"host":hostFromQueryString||"h.imedia.cz","url":protocol+"//__HOST__/hit/?","latencyChance":0.2,"latencyUrl":protocol+"//__HOST__/latency?","thirdPartyCookieUrl":protocol+"//__HOST__/cookie?","latencyDelay":10*1000,"delay":800,"query":"","service":"","lsid":"","id":"","rus":"","rusId":"","version":"2.11","spa":false,"hash":"","pageViewId":"","impress":true,"mousedown":true,"load":true,"error":false,"abtest":"","serviceVariant":"","hitTimeout":60000,"lazyLoadingEnabled":false};this._init();};DOT.prototype.getNewInstance=function(){return new DOT();};DOT.prototype.hit=function(action,data,callback){var d=data||{};d.a=action;this._addCommon(d);if(this._lazyLoadingStatus===LAZY_LOADING_ENABLED){this._hitQueue.push({"data":d,"callback":callback});}else{this._serialize(d);return this._send(d,callback);}},DOT.prototype.hitAsync=function(action,data,cb){var that=this;cb=cb||function(){};setTimeout(function(){cb(that.hit(action,data));},0);},DOT.prototype.isConfigured=function(){return this._configured===1;},DOT.prototype.setAfterCfgEvent=function(){this._fireEventAfterCfg=true;return AFTER_CFG_EVENT;},DOT.prototype._fireAfterCfgEvent=function(){if(this._fireEventAfterCfg){var event=new CustomEvent(AFTER_CFG_EVENT);window.dispatchEvent(event);}},DOT.prototype._addAdditionalCfg=function(hit,cfg,commonCfgList){for(var p in cfg){if(commonCfgList[p]){hit[commonCfgList[p]]=cfg[p];}}},DOT.prototype._sentSavedHits=function(additionalCfg){var commonCfgList={"rus":"rus","rusId":"ri"};this._hitQueue.forEach((function(hit){this._addAdditionalCfg(hit.data,additionalCfg,commonCfgList);this._serialize(hit.data);this._send(hit.data,hit.callback);}).bind(this));this._hitQueue=[];},DOT.prototype.cfg=function(cfg,callback){for(var p in cfg){this._cfg[p]=cfg[p];}if(cfg===undefined||!("hash" in cfg)){this._cfg.hash=this._computeHash();}if(cfg!==undefined){if(cfg.lazyLoadingEnabled===true){this._lazyLoadingStatus=LAZY_LOADING_ENABLED;this._sentBeforeUnload=this._sentSavedHits.bind(this);this._add(window,"beforeunload",this._sentBeforeUnload);}else{if(cfg.lazyLoadingEnabled===false&&this._lazyLoadingStatus===LAZY_LOADING_ENABLED){this._lazyLoadingStatus=LAZY_LOADING_DISABLED;this._remove(window,"beforeunload",this._sentBeforeUnload);this._sentSavedHits(cfg);return;}}}if(this._cfg.impress){if(this.cookieImg.complete){this.impress(callback);}else{this.cookieImg.onload=(function(){this.impress(callback);}).bind(this);}}if(this._configured){return;}this._configured=1;this._fireAfterCfgEvent();if(this._cfg.mousedown){this._add(document,"mousedown",(function(e){this._mousedown(e);}).bind(this));}if(this._cfg.load){this._add(window,"load",(function(e){this.load(e);}).bind(this));}if(this._cfg.error){this._add(window,"error",(function(e){this.error(e);}).bind(this),false,true);}if(Math.random()<this._cfg.latencyChance){setTimeout((function(){this._measureLatency();}).bind(this),this._cfg.latencyDelay);}},DOT.prototype._getSPAReferrer=function(){var referrer=this._SPAReferrer?this._SPAReferrer:document.referrer;this._SPAReferrer=window.location.href;return referrer;},DOT.prototype.impress=function(callback){var data={"q":this._cfg.query,"d":{"tid":window.name,"referer":this._cfg.spa?this._getSPAReferrer():document.referrer,"path":this._getDataDot(document.body)}};if(this._cfg.spa){this._setWindowNameWithId();}this._getDataDotData(document.body,data);this._addGeometry(data);this.hit("impress",data,callback);},DOT.prototype.load=function(){this._dataElms=[];var all=document.getElementsByTagName("*");for(var i=0;i<all.length;i++){if(all[i].getAttribute("data-elm")){this._dataElms.push(all[i]);}}var ts=new Date().getTime();var data={"d":{"time":ts-this._ts}};this._addGeometry(data);this.hit("load",data);},DOT.prototype.error=function(e,callback){var d={"type":"js"};if(typeof (e)=="object"){var keys=["message","filename","lineno","colno"];for(var i=0;i<keys.length;i++){var key=keys[i];if(key in e){d[key]=e[key];}}if(e.error&&e.error.stack){d.stack=e.error.stack;}}else{d.message=e;}this.hit("error",{"d":d},callback);},DOT.prototype._setWindowNameWithId=function(){this._cfg.id=""+new Date().getTime()+Math.random();if(!window.name){window.name=this._cfg.id;}},DOT.prototype._init=function(){this._setThirdPartyCookie();this._ts=new Date().getTime();this._setWindowNameWithId();this._plugins=this._getPlugins();this._lastSession=this._ts;try{if(window.localStorage){var localStorageKey="dot_lastSession";this._lastSession=localStorage.getItem(localStorageKey)||0;localStorage.setItem(localStorageKey,this._ts);}}catch(e){}},DOT.prototype._delay=function(action,e){this._delayed.action=action;if(this._delayed.timeout){clearTimeout(this._delayed.timeout);this._delayed.timeout=null;}this._delayed.count++;this._delayed.timeout=setTimeout((function(){this._sendDelayed();}).bind(this),this._cfg.delay);},DOT.prototype._remove=function(elm,event,cb){if(elm.removeEventListener){elm.removeEventListener(event,cb);}else{elm.detachEvent("on"+event,cb);}};DOT.prototype._add=function(elm,event,cb,capture,preferAttachEvent){if(preferAttachEvent&&elm.attachEvent){elm.attachEvent("on"+event,cb);}else{if(elm.addEventListener){var c=(arguments.length>3?capture:true);elm.addEventListener(event,cb,c);}else{if(elm.attachEvent){elm.attachEvent("on"+event,cb);}}}},DOT.prototype._serialize=function(data){for(var p in data){var val=data[p];if(typeof (val)=="object"){if(window.JSON){data[p]=JSON.stringify(val);}else{data[p]=this._serializeValue(val);}}}},DOT.prototype._serializeValue=function(value){if(value===null){return "null";}if(value instanceof Array){var arr=[];for(var i=0;i<value.length;i++){arr.push(this._serializeValue(value[i]));}return "["+arr.join(",")+"]";}else{if(typeof (value)=="object"){var arr=[];for(var p in value){if(p in {}){continue;}arr.push("\""+this._escapeString(p)+"\":"+this._serializeValue(value[p]));}return "{"+arr.join(",")+"}";}else{if(typeof (value)=="string"){return "\""+this._escapeString(value)+"\"";}else{return value;}}}},DOT.prototype._addCommon=function(data){data.s=this._cfg.service;data.lsid=this._cfg.lsid;data.id=this._cfg.id;data.v=this._cfg.version;data.r=Math.random();data.h=this._cfg.hash;data.rus=this._cfg.rus;data.ri=this._cfg.rusId==null?"":this._cfg.rusId;data.pvid=this._cfg.pageViewId;data.spa=this._cfg.spa;var playerUrl="www.seznamzpravy.cz/iframe/player";if(document.location.href.indexOf(playerUrl)!=-1){data.u=document.location.href.substring(0,document.location.href.indexOf("?"));}else{data.u=document.location.href;}data.lses=this._lastSession;data.ab=this._cfg.abtest;data.serviceVariant=this._cfg.serviceVariant;data.ptitle=document.title;},DOT.prototype._addGeometry=function(data){if(!document.body){return;}if(!data.d){data.d={};}var d=data.d;var sx=document.documentElement.scrollLeft||document.body.scrollLeft||0;var sy=document.documentElement.scrollTop||document.body.scrollTop||0;d.scroll=sx+","+sy;var w=document.documentElement.clientWidth||document.body.clientWidth||0;var h=document.documentElement.clientHeight||document.body.clientHeight||0;d.port=w+","+h;d.page=document.body.offsetWidth+","+document.body.offsetHeight;d.screen=screen.width+","+screen.height+","+screen.colorDepth;var visible=this._getDataElm(sx,sy,w,h);if(visible.length){d.elm=visible.join(",");}},DOT.prototype._send=function(data,callback){var arr=[];var callbackCalled=false;for(var p in data){var val=data[p];arr.push(encodeURIComponent(p)+"="+encodeURIComponent(val));}var url=this._cfg.url.replace("__HOST__",this._cfg.host)+arr.join("&");var img=document.createElement("img");if(typeof callback==="function"){var timeoutId=setTimeout(function(){var error=new Error("Hit timed out");error.name="TimeoutError";callCallback(error);},this._cfg.hitTimeout);img.onerror=function(event){callCallback((event&&event.error)||new Error("Hit failed"));};img.onabort=function(){var error=new Error("Hit aborted");error.name="AbortError";callCallback(error);};img.onload=function(){callCallback();};function callCallback(argument){clearTimeout(timeoutId);if(!callbackCalled){callback(argument);callbackCalled=true;}}}img.src=url;return img;},DOT.prototype._getPlugins=function(){var data=[];if(navigator.plugins&&navigator.plugins.length){for(var i=0;i<navigator.plugins.length;i++){var plug=navigator.plugins[i];var name=(plug.name.match(/[0-9]/)?plug.name:plug.description);data.push(name);}}else{if(window.ActiveXObject){var DEF={"AcroPDF.PDF":function(){return this.GetVersions();},"PDF.PdfCtrl":function(){return this.GetVersions();},"ShockwaveFlash.ShockwaveFlash":function(){return this.GetVariable("$version");},"QuickTime.QuickTime":function(){return this.QuickTimeVersion;},"rmocx.RealPlayer G2 Control":function(){return this.GetVersionInfo();},"rmocx.RealPlayer G2 Control.1":function(){return this.GetVersionInfo();},"RealPlayer.RealPlayer(tm) ActiveX Control (32-bit)":function(){return this.GetVersionInfo();},"RealVideo.Rep.CalVideo(tm) ActiveX Control (32-bit)":function(){return this.GetVersionInfo();},"RealPlayer":function(){return this.GetVersionInfo();},"WMPlayer.OCX":function(){return this.versionInfo;}};var o,name;for(var p in DEF){try{o=new ActiveXObject(p);name=p;}catch(e){continue;}try{name+=" "+DEF[p].call(o);}catch(e){}data.push(name);}}}return data;},DOT.prototype._computeHash=function(){var options={};if("canvas" in this._cfg){options.canvas=this._cfg.canvas;}return new SF(options).get();},DOT.prototype._getCSSPath=function(elm){var arr=[];var node=elm;while(node&&node!=document&&node.getAttribute){var value=node.getAttribute("class");if(value){var valuesArray=value.split(" ");if(valuesArray.length===1){arr.unshift(value);}else{arr.unshift(valuesArray.sort().join("."));}}node=node.parentNode;}return arr.join("/");},DOT.prototype._getDataDot=function(elm){var arr=[];var node=elm;while(node&&node!=document&&node.getAttribute){var value=node.getAttribute("data-dot");if(value){arr.unshift(value);}node=node.parentNode;}return arr.join("/");},DOT.prototype._getDataDotData=function(elm,data){var node=elm;while(node&&node!=document&&node.getAttribute){var valueDotData=node.getAttribute("data-dot-data"),dataDot=undefined;if(!valueDotData){node=node.parentNode;continue;}try{dataDot=JSON.parse(valueDotData);for(var key in dataDot){if(!(key in data.d)){data.d[key]=dataDot[key];}}}catch(e){}node=node.parentNode;}},DOT.prototype._getDataElm=function(x,y,w,h){var results=[];for(var i=0;i<this._dataElms.length;i++){var elm=this._dataElms[i];var left=elm.offsetWidth/2;var top=elm.offsetHeight/2;while(elm){left+=elm.offsetLeft;top+=elm.offsetTop;elm=elm.offsetParent;}if(left>=x&&left<=x+w&&top>=y&&top<=y+h){results.push(this._dataElms[i].getAttribute("data-elm"));this._dataElms.splice(i,1);i--;}}return results;},DOT.prototype._getDataFieldValue=function(elm){var node=elm;while(node&&node!=document){var value=node.getAttribute("data-fieldvalue");if(value!==null){return (value=="1"?true:false);}node=node.parentNode;}return true;},DOT.prototype._escapeString=function(str){var re=/["\\\n\r\t]/g;var replace={"\n":"\\n","\t":"\\t","\r":"\\r","\"":"\\\"","\\":"\\\\"};return str.replace(re,function(ch){return replace[ch];});},DOT.prototype._mousedown=function(e){var target=e.target||e.srcElement;var data={"d":{"pos":e.pageX+","+e.pageY,"path":this._getDataDot(target),"css_path":this._getCSSPath(target)}};if(!this._cfg.spa){this._getDataDotData(target,data);}var name=target.nodeName.toLowerCase();if(name=="input"||name=="textarea"||name=="select"){if(target.name){data.d.fieldname=target.name;}if(target.type!="password"&&this._getDataFieldValue(target)){data.d.fieldvalue=target.value;}}while(target&&target!=document){name=target.nodeName.toLowerCase();if(name=="a"){data.d.href=target.href;if(!target.getAttribute("data-dot-disabled")){var textFromAttr=target.getAttribute("data-dot-text");data.d.text=(textFromAttr||target.textContent||target.innerText||"").replace(/\s{2,}/g," ").substring(0,100);}break;}target=target.parentNode;}this.hit("mousedown",data);},DOT.prototype._sendDelayed=function(){var data={"d":{"count":this._delayed.count+""}};this._addGeometry(data);this.hit(this._delayed.action,data);this._delayed.count=0;},DOT.prototype._measureLatency=function(){var img=document.createElement("img");img.onload=(function(){var diff=new Date().getTime()-ts;this.hit("event",{"d":{"action":"latency","latency":diff}});}).bind(this);var ts=new Date().getTime();img.src=this._cfg.latencyUrl.replace("__HOST__",this._cfg.host)+Math.random();},DOT.prototype._setThirdPartyCookie=function(){var img=this.cookieImg=document.createElement("img");img.src=this._cfg.thirdPartyCookieUrl.replace("__HOST__",this._cfg.host)+Math.random();};var SF=function(options){var canvasDefault=true;if(navigator&&navigator.userAgent){if(navigator.userAgent.toLowerCase().indexOf("hbbtv")>-1){canvasDefault=false;}}this._options={"ua":false,"canvas":canvasDefault,"log":null};for(var p in options){this._options[p]=options[p];}if(this._options.canvas){if(!document.createElement("canvas").getContext){this._options.canvas=false;}}};SF.prototype.get=function(options){for(var p in options){this._options[p]=options[p];}this._log("-> get fingerprint with options",this._options);var result="";result+=this._getText();if(this._options.canvas){result+=this._getCanvas();}return result;};SF.prototype._getText=function(){var str="";this._log("getting navigator props");var blacklist=["buildID","battery","appVersion","mimeTypes"];if(!this._options.ua){blacklist.push("userAgent");}var cache=[];var depth=0;var get=function(obj){if(cache.indexOf(obj)>-1){return;}if(depth>3){return;}depth++;cache.push(obj);for(var p in obj){if(blacklist.indexOf(p)>-1){continue;}try{var v=obj[p];}catch(e){continue;}switch(typeof (v)){case "object":try{get(v);}catch(e){}break;case "number":case "string":str+=v;break;}}depth--;};get(navigator);if(this._options.canvas){var c=document.createElement("canvas");var gl=null;try{gl=c.getContext("experimental-webgl")||c.getContext("webgl");}catch(e){}if(gl){this._log("adding webgl props");str+=gl.getParameter(gl.VENDOR);str+=gl.getParameter(gl.RENDERER);str+=gl.getParameter(gl.VERSION);}}this._log("text data:",str);return this._hash(str);};SF.prototype._getCanvas=function(){var canvas=this._drawCanvas();var data=canvas.toDataURL("image/jpeg");this._log("image data:",data);return this._hash(data);};SF.prototype._drawCanvas=function(){var c=document.createElement("canvas");var ctx=c.getContext("2d");ctx.fillStyle="#fff";ctx.fillRect(0,0,c.width,c.height);var strings=[];var count=25;[32,64,96,256].forEach(function(code,codeIndex){var str="";for(var i=0;i<count;i++){str+=String.fromCharCode(code+i);}strings.push(str);});[{"font":"14px droid sand mono,ubuntu,serif","fill":"rgba(255, 30, 30, 0.3)","stroke":"rgba(30, 30, 255, 0.3)"},{"font":"12pt helvetica,arial,sans-serif","fill":"rgba(30, 255, 30, 0.3)","stroke":"rgba(255, 255, 30, 0.3)"}].forEach(function(style,styleIndex){var y=0;var i=0;ctx.font=style.font;ctx.fillStyle=style.fill;ctx.strokeStyle=style.stroke;strings.forEach(function(str,strIndex){var y=(1+strIndex+styleIndex/3)*20;ctx.strokeText(str,0,y);ctx.fillText(str,0,y);});});this._log(c);return c;};SF.prototype._hash=function(str){var num=this._fnv1aHashString(str);this._log("num",num);var hash="";for(var i=0;i<8;i++){var n=(num>>(4*i))&15;hash=n.toString(16)+hash;}var control=parseInt(hash,16)%17;this._log("control",control);hash+=(control%16).toString(16);return hash;};SF.prototype._fnv1aHashString=function(string){var fnvPrime=16777619;var hash=2166136261;for(var i=0,c=string.length;i<c;i++){var code=string.charCodeAt(i)&255;hash=hash^code;hash=(hash*fnvPrime)|0;}return hash;};SF.prototype._log=function(){var node=this._options.log;if(!node){return;}var args=[];for(var i=0;i<arguments.length;i++){var a=arguments[i];if(a.nodeType){node.appendChild(a);continue;}args.push(typeof (a)=="object"?JSON.stringify(a):a);}var text=document.createTextNode(args.join(" ")+"\n");node.appendChild(text);};window.DOT=new DOT();})();}}
